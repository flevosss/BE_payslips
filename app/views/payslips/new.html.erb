<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" data-controller="employee-select">


  <div class="bg-white rounded-2xl shadow-xl p-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <div class="space-y-6 border-r border-gray-200 pr-8">
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Select Employee</h3>
        
        <%= render 'shared/search_bar', 
            search_path: new_payslip_path,
            placeholder: "Search employees...",
            centered: false %>
        
        <div class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
          <% @employees.each do |employee| %>
            <div data-action="click->employee-select#selectEmployee"
                 data-employee-select-target="card"
                 data-employee-id="<%= employee.id %>"
                 data-employee-name="<%= employee.first_name %> <%= employee.last_name %>"
                 data-employee-email="<%= employee.user.email %>">
              <%= render 'shared/employee_card', 
                  employee: employee, 
                  selected: @payslip.employee_id == employee.id %>
            </div>
          <% end %>
        </div>
      </div>

      <%= form_with model: @payslip, url: payslips_path, method: :post, local: true, class: "lg:col-span-2" do |f| %>
        <%= f.hidden_field :employee_id, value: @payslip.employee_id, data: { employee_select_target: "hiddenField" }, required: true %>
        
        <div class="space-y-6">
          <h3 class="text-xl font-semibold text-gray-900 mb-4">Payslip Details</h3>
          
          <div data-employee-select-target="placeholder" class="flex items-center justify-center min-h-[500px]" style="<%= @payslip.employee_id.present? ? 'display: none;' : '' %>">
            <div class="text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <p class="mt-4 text-lg font-medium text-gray-900">Please select an employee first</p>
              <p class="mt-2 text-sm text-gray-500">Choose an employee from the list on the left to create a payslip</p>
            </div>
          </div>
          
          <div data-employee-select-target="formFields" class="space-y-6" style="<%= @payslip.employee_id.blank? ? 'display: none;' : '' %>">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Selected Employee
                </label>
                <div data-employee-select-target="employeeDisplay">
                  <% selected_employee = @employees.find { |e| e.id == @payslip.employee_id } %>
                  <% if selected_employee %>
                    <%= render 'shared/employee_card', employee: selected_employee, selected: true %>
                  <% end %>
                </div>
              </div>
              
          <div>
            <label for="payslip_date" class="block text-sm font-medium text-gray-700 mb-2">
              Payslip Date <span class="text-red-600">*</span>
            </label>
            <%= render RubyUI::Popover.new(options: { trigger: "click" }) do %>
              <%= render RubyUI::PopoverTrigger.new(class: "w-full") do %>
                <%= f.text_field :date,
                    value: (@payslip.date || Date.current).strftime('%Y-%m-%d'),
                    placeholder: "Select payslip date",
                    class: "w-full rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-green-950 focus:bg-white px-3 py-2.5",
                    id: "payslip_date_input",
                    data: { controller: "ruby-ui--calendar-input" },
                    required: true %>
              <% end %>
              <%= render RubyUI::PopoverContent.new do %>
                <%= render RubyUI::Calendar.new(
                  selected_date: @payslip.date || Date.current,
                  input_id: "#payslip_date_input"
                ) %>
              <% end %>
            <% end %>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="payslip_start_period" class="block text-sm font-medium text-gray-700 mb-2">
                Start Period <span class="text-red-600">*</span>
              </label>
              <%= render RubyUI::Popover.new(options: { trigger: "click" }) do %>
                <%= render RubyUI::PopoverTrigger.new(class: "w-full") do %>
                  <%= f.text_field :start_period,
                      value: @payslip.start_period&.strftime('%Y-%m-%d'),
                      placeholder: "Select start period",
                      class: "w-full rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-green-950 focus:bg-white px-3 py-2.5",
                      id: "start_period_input",
                      data: { controller: "ruby-ui--calendar-input" },
                      required: true %>
                <% end %>
                <%= render RubyUI::PopoverContent.new do %>
                  <%= render RubyUI::Calendar.new(
                    selected_date: @payslip.start_period || Date.current,
                    input_id: "#start_period_input"
                  ) %>
                <% end %>
              <% end %>
            </div>
            <div>
              <label for="payslip_end_period" class="block text-sm font-medium text-gray-700 mb-2">
                End Period <span class="text-red-600">*</span>
              </label>
              <%= render RubyUI::Popover.new(options: { trigger: "click" }) do %>
                <%= render RubyUI::PopoverTrigger.new(class: "w-full") do %>
                  <%= f.text_field :end_period,
                      value: @payslip.end_period&.strftime('%Y-%m-%d'),
                      placeholder: "Select end period",
                      class: "w-full rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-green-950 focus:bg-white px-3 py-2.5",
                      id: "end_period_input",
                      data: { controller: "ruby-ui--calendar-input" },
                      required: true %>
                <% end %>
                <%= render RubyUI::PopoverContent.new do %>
                  <%= render RubyUI::Calendar.new(
                    selected_date: @payslip.end_period || Date.current,
                    input_id: "#end_period_input"
                  ) %>
                <% end %>
              <% end %>
            </div>
          </div>

          <div>
            <label for="payslip_pay_date" class="block text-sm font-medium text-gray-700 mb-2">
              Pay Date <span class="text-red-600">*</span>
            </label>
            <%= render RubyUI::Popover.new(options: { trigger: "click" }) do %>
              <%= render RubyUI::PopoverTrigger.new(class: "w-full") do %>
                <%= f.text_field :pay_date,
                    value: @payslip.pay_date&.strftime('%Y-%m-%d'),
                    placeholder: "Select pay date",
                    class: "w-full rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-green-950 focus:bg-white px-3 py-2.5",
                    id: "pay_date_input",
                    data: { controller: "ruby-ui--calendar-input" },
                    required: true %>
              <% end %>
              <%= render RubyUI::PopoverContent.new do %>
                <%= render RubyUI::Calendar.new(
                  selected_date: @payslip.pay_date || Date.current,
                  input_id: "#pay_date_input"
                ) %>
              <% end %>
            <% end %>
          </div>

          <div>
            <label for="payslip_salary" class="block text-sm font-medium text-gray-700 mb-2">
              Salary Amount <span class="text-red-600">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span class="text-gray-500 sm:text-sm">â‚¬</span>
              </div>
              <%= f.number_field :salary, 
                  step: 0.01,
                  placeholder: "0.00",
                  class: "w-full pl-8 rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-green-950 focus:bg-white px-3 py-2.5",
                  required: true %>
            </div>
          </div>

          <div>
            <label for="payslip_notes" class="block text-sm font-medium text-gray-700 mb-2">
              Notes <span class="text-red-600">*</span>
            </label>
            <%= f.text_area :notes, 
                rows: 3,
                class: "w-full resize-none rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-green-950 focus:bg-white px-3 py-2.5" %>
          </div>
          
          <div class="flex gap-4 mt-8 pt-6 border-t border-gray-200 justify-center">
            <%= f.submit "Create Payslip", 
                class: "bg-green-900 text-white px-8 py-3 rounded-md hover:bg-green-800 transition-colors font-medium text-lg" %>
            <%= link_to "Cancel", 
                payslips_path, 
                class: "bg-gray-200 text-gray-700 px-8 py-3 rounded-md hover:bg-gray-300 transition-colors font-medium text-lg" %>
          </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

