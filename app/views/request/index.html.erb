<% content_for :title, "Request Leave - RailSlips" %>

  <% if current_user.employee&.department.blank? %>
    <div class="bg-white rounded-2xl shadow-sm p-8 border border-gray-100">
      <div class="text-center py-8">
        <%= heroicon "exclamation-triangle", variant: :outline, options: { class: "w-16 h-16 text-gray-400 mx-auto mb-4" } %>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">No Department Assigned</h3>
        <p class="text-gray-600">Please contact your employer to complete your profile.</p>
      </div>
    </div>
  <% else %>
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
      
      <div class="lg:col-span-4">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200">
          <div class="flex items-center px-6 py-4 border-b border-gray-100">
            <div class="w-10 h-10  flex items-center justify-center">
              <%= heroicon "calendar-days", variant: :solid, options: { class: "w-5 h-5 text-green-900" } %>
            </div>
            <h2 class="text-xl font-bold text-gray-900">New Request</h2>
          </div>
          
          <%= form_with model: @vacation_request, url: request_path, class: "space-y-5 p-6" do |f| %>
            
            <div>
              <%= f.label :leave_type, "Type of Leave", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= render RubyUI::Select.new do %>
                <%= render RubyUI::SelectInput.new(name: "vacation_request[leave_type]", value: @vacation_request.leave_type, required: true) %>
                <%= render RubyUI::SelectTrigger.new do %>
                  <%= render RubyUI::SelectValue.new(placeholder: "Select leave type") do %>
                    <%= @vacation_request.leave_type.present? ? LEAVE_TYPES_SELECT.find { |lt| lt[1] == @vacation_request.leave_type }&.first : "Select leave type" %>
                  <% end %>
                <% end %>
                <%= render RubyUI::SelectContent.new do %>
                  <% LEAVE_TYPES_SELECT.each do |label, value| %>
                    <%= render RubyUI::SelectItem.new(value: value, **{ aria: { selected: (@vacation_request.leave_type == value).to_s } }) { label } %>
                  <% end %>
                <% end %>
              <% end %>
              <% if @vacation_request.errors[:leave_type].any? %>
                <p class="mt-1.5 text-xs text-red-600 font-medium flex items-center">
                  <%= heroicon "exclamation-circle", variant: :mini, options: { class: "w-3.5 h-3.5 mr-1" } %>
                  <%= @vacation_request.errors[:leave_type].first %>
                </p>
              <% end %>
            </div>
            
            <div>
              <%= f.label :start_date, class: "block text-sm font-medium text-gray-700 mb-2" do %>
                Start Date
              <% end %>
              <%= render RubyUI::Popover.new(options: { trigger: "click" }) do %>
                <%= render RubyUI::PopoverTrigger.new(class: "w-full") do %>
              <%= f.text_field :start_date,
                  value: @vacation_request.start_date&.strftime('%Y-%m-%d'),
                  placeholder: "Select start date",
                  class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-green-950 text-sm transition-all",
                  id: "start_date_input",
                  data: { controller: "ruby-ui--calendar-input" },
                  required: true %>
                <% end %>
                <%= render RubyUI::PopoverContent.new do %>
                  <%= render RubyUI::Calendar.new(
                    selected_date: @vacation_request.start_date || Date.today,
                    input_id: "#start_date_input"
                  ) %>
                <% end %>
              <% end %>
              <% if @vacation_request.errors[:start_date].any? %>
                <p class="mt-1.5 text-xs text-red-600 font-medium flex items-center">
                  <%= heroicon "exclamation-circle", variant: :mini, options: { class: "w-3.5 h-3.5 mr-1" } %>
                  <%= @vacation_request.errors[:start_date].first %>
                </p>
              <% end %>
            </div>

            <div>
              <%= f.label :end_date, class: "block text-sm font-medium text-gray-700 mb-2" do %>
                End Date
              <% end %>
              <%= render RubyUI::Popover.new(options: { trigger: "click" }) do %>
                <%= render RubyUI::PopoverTrigger.new(class: "w-full") do %>
              <%= f.text_field :end_date,
                  value: @vacation_request.end_date&.strftime('%Y-%m-%d'),
                  placeholder: "Select end date",
                  class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-green-950 text-sm transition-all",
                  id: "end_date_input",
                  data: { controller: "ruby-ui--calendar-input" },
                  required: true %>
                <% end %>
                <%= render RubyUI::PopoverContent.new do %>
                  <%= render RubyUI::Calendar.new(
                    selected_date: @vacation_request.end_date || Date.today,
                    input_id: "#end_date_input"
                  ) %>
                <% end %>
              <% end %>
              <% if @vacation_request.errors[:end_date].any? %>
                <p class="mt-1.5 text-xs text-red-600 font-medium flex items-center">
                  <%= heroicon "exclamation-circle", variant: :mini, options: { class: "w-3.5 h-3.5 mr-1" } %>
                  <%= @vacation_request.errors[:end_date].first %>
                </p>
              <% end %>
            </div>

            <div>
              <%= f.label :reason, class: "block text-sm font-medium text-gray-700 mb-2" do %>
                Reason
              <% end %>
              <%= f.text_area :reason, 
                  rows: 4,
                  class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-green-950 text-sm resize-none transition-all",
                  required: true %>
              <% if @vacation_request.errors[:reason].any? %>
                <p class="mt-1.5 text-xs text-red-600 font-medium flex items-center">
                  <%= heroicon "exclamation-circle", variant: :mini, options: { class: "w-3.5 h-3.5 mr-1" } %>
                  <%= @vacation_request.errors[:reason].first %>
                </p>
              <% end %>
            </div>

            <%= f.submit "Submit Request", 
                class: "w-full bg-green-900 text-white py-3 rounded-lg hover:bg-green-800 transition-all font-semibold shadow-md hover:shadow-lg cursor-pointer" %>
          <% end %>
        </div>
      </div>

      <div class="lg:col-span-8">
        <%= render 'shared/requests_list', 
            requests: @vacation_requests,
            container_class: "h-[596px]",
            empty_message: "Submit your first leave request to get started!" %>
      </div>

    </div>

  <% end %>
</div>
